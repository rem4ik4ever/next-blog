{"ast":null,"code":"import devonlyMiddleware from 'src/middlewares/devonly.middleware';\nimport { v4 } from 'uuid';\nimport utilities from '@rem-blog/utilities';\n\nconst handler = async (req, res) => {\n  const {\n    whoops,\n    allGood\n  } = utilities.Response;\n  const {\n    s3UploadFile\n  } = utilities.AWS_S3;\n  const {\n    fetchAndTransformImageFromUrl\n  } = utilities.Images;\n  const {\n    saveImageSizeToFile\n  } = utilities.Files;\n\n  try {\n    await devonlyMiddleware(req, res);\n    const {\n      id\n    } = req.query;\n    const file = utilities.Files.allFiles().find(fl => String(fl.id) === String(id));\n\n    if (!file) {\n      return whoops(res);\n    }\n\n    const {\n      source,\n      w\n    } = req.body;\n\n    if (!source) {\n      whoops(res);\n    }\n\n    const transformedImage = await fetchAndTransformImageFromUrl(String(source), String(w));\n    const uuid = v4();\n    const uploadResult = await s3UploadFile(transformedImage, `assets/${uuid}-${w}.png`);\n    await saveImageSizeToFile(String(source), String(w), uploadResult);\n    allGood(res);\n  } catch (err) {\n    console.error(err);\n    whoops(res);\n  }\n};\n\nexport default handler;","map":null,"metadata":{},"sourceType":"module"}